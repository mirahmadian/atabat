{% extends 'admin_layout.html' %}

{% block content %}
  <h2 class="mb-3">{{ 'ویرایش' if assignment else 'افزودن' }} ماموریت</h2>
  <form method="post">
    <div class="mb-3">
      <label for="guide_name" class="form-label">نام مدیر راهنما:</label>
      <input type="text" name="guide_name" id="guide_name" class="form-control" value="{{ assignment['guide_name'] if assignment else '' }}" required>
    </div>
    <div class="mb-3">
      <label for="guide_national_id" class="form-label">کد ملی مدیر راهنما:</label>
      <input type="text" name="guide_national_id" id="guide_national_id" class="form-control" value="{{ assignment['guide_national_id'] if assignment else '' }}" required>
    </div>

    <div class="mb-3">
      <label for="enter_date" class="form-label">تاریخ ورود (شمسی):</label>
      <input type="text" name="enter_date" id="enter_date" class="form-control" value="{{ assignment['enter_date'] if assignment else '' }}" required autocomplete="off" readonly>
    </div>
    <div class="mb-3">
      <label for="exit_date" class="form-label">تاریخ خروج (شمسی):</label>
      <input type="text" name="exit_date" id="exit_date" class="form-control" value="{{ assignment['exit_date'] if assignment else '' }}" required autocomplete="off" readonly>
    </div>
    
    <div class="mb-3">
      <label for="city" class="form-label">شهر:</label>
      <input type="text" name="city" id="city" class="form-control" value="{{ assignment['city'] if assignment else '' }}" required>
    </div>
    <div class="mb-3">
      <label for="hotel_name" class="form-label">نام هتل:</label>
      <input type="text" name="hotel_name" id="hotel_name" class="form-control" value="{{ assignment['hotel_name'] if assignment else '' }}" required>
    </div>
    <div class="mb-3">
      <label for="fixed_manager_name" class="form-label">نام مدیر ثابت:</label>
      <input type="text" name="fixed_manager_name" id="fixed_manager_name" class="form-control" value="{{ assignment['fixed_manager_name'] if assignment else '' }}" required>
    </div>
    
    <button type="submit" class="btn btn-success">ذخیره تغییرات</button>
    <a href="{{ url_for('admin_index') }}" class="btn btn-secondary">انصراف</a>
  </form>
{% endblock %}

{% block scripts %}
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
  <!-- Persian Web Toolkit DatePicker -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/css/persian-datepicker.min.css">
  <script src="https://cdn.jsdelivr.net/npm/persian-date@1.1.0/dist/persian-date.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/persian-datepicker@1.2.0/dist/js/persian-datepicker.min.js"></script>
  
  <script>
    $(document).ready(function() {
      // تنظیمات تقویم برای تاریخ ورود
      $("#enter_date").persianDatepicker({
        format: 'YYYY-MM-DD',
        autoClose: true,
        initialValue: true,
        inline: false,
        observer: true,
        altField: '#enter_date',
        altFormat: 'YYYY-MM-DD',
        timePicker: {
          enabled: false
        },
        dayPicker: {
          enabled: true
        },
        monthPicker: {
          enabled: true
        },
        yearPicker: {
          enabled: true
        },
        navigator: {
          enabled: true,
          scroll: {
            enabled: true
          },
          text: {
            btnNextText: '‹',
            btnPrevText: '›'
          }
        },
        toolbox: {
          enabled: true,
          calendarSwitch: {
            enabled: false
          },
          todayButton: {
            enabled: true,
            text: {
              fa: 'امروز'
            }
          },
          submitButton: {
            enabled: true,
            text: {
              fa: 'تایید'
            }
          }
        },
        onSelect: function(unix) {
          console.log('تاریخ ورود انتخاب شد:', this.model.formatted);
        }
      });

      // تنظیمات تقویم برای تاریخ خروج
      $("#exit_date").persianDatepicker({
        format: 'YYYY-MM-DD',
        autoClose: true,
        initialValue: true,
        inline: false,
        observer: true,
        altField: '#exit_date',
        altFormat: 'YYYY-MM-DD',
        timePicker: {
          enabled: false
        },
        dayPicker: {
          enabled: true
        },
        monthPicker: {
          enabled: true
        },
        yearPicker: {
          enabled: true
        },
        navigator: {
          enabled: true,
          scroll: {
            enabled: true
          },
          text: {
            btnNextText: '‹',
            btnPrevText: '›'
          }
        },
        toolbox: {
          enabled: true,
          calendarSwitch: {
            enabled: false
          },
          todayButton: {
            enabled: true,
            text: {
              fa: 'امروز'
            }
          },
          submitButton: {
            enabled: true,
            text: {
              fa: 'تایید'
            }
          }
        },
        onSelect: function(unix) {
          console.log('تاریخ خروج انتخاب شد:', this.model.formatted);
        }
      });
    });
  </script>
{% endblock %}
